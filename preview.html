<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Flipbook Preview</title>
  <style>
    body { margin: 0; background: #111; display: flex; justify-content: center; align-items: center; height: 100vh; }
    canvas { image-rendering: pixelated; }
  </style>
</head>
<body>
  <canvas id="flipbook"></canvas>
  <script>
    const canvas = document.getElementById("flipbook");
    const ctx = canvas.getContext("2d");
    let frames = [];
    let index = 0;
    let delay = 100;

    // Let plugin know we're ready
    window.opener?.postMessage("READY_FOR_IMAGES", "*");

    window.addEventListener("message", (event) => {
      if (event.data?.type === "images") {
        frames = event.data.images;
        console.log(`âœ… Received ${frames.length} images`);

        const img = new Image();
        img.onload = () => {
          canvas.width = img.width;
          canvas.height = img.height;
          startAnimation();
        };
        img.src = frames[0];
      }
    });

    function startAnimation() {
      setInterval(() => {
        const img = new Image();
        img.onload = () => ctx.drawImage(img, 0, 0);
        img.src = frames[index];
        index = (index + 1) % frames.length;
      }, delay);
    }
  </script>
</body>
</html>
