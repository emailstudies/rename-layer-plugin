<!DOCTYPE html>
<html>
<body>
  <button id="renameBtn">Launch Preview</button>

  <script>
    document.getElementById('renameBtn').onclick = () => {
      const preview = window.open("", "_blank");
      preview.document.write(`
        <!DOCTYPE html>
        <html>
        <head>
          <title>Flipbook Preview</title>
          <style>
            html, body {
              margin: 0; padding: 0;
              width: 100%; height: 100%;
              overflow: hidden;
            }
            #container {
              position: fixed;
              inset: 0;
              display: flex;
              justify-content: center;
              align-items: center;
              background: #111;
            }
            iframe {
              border: none;
            }
            #toolbar {
              position: absolute;
              top: 10px;
              left: 10px;
              background: rgba(0, 0, 0, 0.6);
              color: white;
              padding: 6px 12px;
              border-radius: 4px;
              font-size: 16px;
              z-index: 10;
              pointer-events: none;
            }
          </style>
        </head>
        <body>
          <div id="container">
            <iframe id="previewFrame"></iframe>
            <div id="toolbar">Frame: <span id="counter">0</span></div>
          </div>
          <script>
            const iframe = document.getElementById('previewFrame');
            const counter = document.getElementById('counter');

            window.addEventListener("message", (event) => {
              if (event.data?.type === 'setup') {
                const { width, height, fps, images } = event.data;
                const scale = Math.min(window.innerWidth / width, window.innerHeight / height);
                iframe.style.width = width + 'px';
                iframe.style.height = height + 'px';
                iframe.style.transform = 'scale(' + scale + ')';
                iframe.style.transformOrigin = 'top left';

                let index = 0;
                setInterval(() => {
                  counter.textContent = index + 1;
                  iframe.contentWindow.postMessage({ type: 'showFrame', index }, '*');
                  index = (index + 1) % images.length;
                }, 1000 / fps);
                iframe.contentWindow.postMessage({ type: 'init', images }, '*');
              }
            });
          </script>
        </body>
        </html>
      `);
    };
  </script>
</body>
</html>
